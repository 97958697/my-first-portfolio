{% extends 'base.html' %}
{% load static %}

{% block title %}{{ movie.title }} - 詳細{% endblock title %}

{% block content %}
<h1>{{ movie.title }}</h1>
<p>{{ movie.description }}</p>
<p><a href="{% url 'reviews:movie_list' %}" class="btn btn-secondary">映画一覧へ戻る</a></p>

{% if movie.image %}
    <img src="{{ movie.image.url }}" alt="{{ movie.title }}" class="movie-detail-poster">
{% endif %}
<p>公開日: {{ movie.release_date }}</p>

<h2>レビュー</h2>
<ul>
{% for review in movie.reviews.all %}
    <li style="margin-bottom:1em;">
        <strong>{{ review.user.username }}: 評価{{ review.rating }}点</strong>
        {% if user.is_authenticated and review.user == user %}
            <a href="{% url 'reviews:update' review.id %}" class="btn btn-secondary btn-sm">編集</a>
        {% endif %}
        <div style="border:1px solid #ccc; padding:8px; margin-top:5px;">
            {{ review.comment }}
        </div>
    </li>
{% empty %}
    <li>No reviews yet.</li>
{% endfor %}
</ul>

{% if user.is_authenticated and not has_review %}
    <a href="{% url 'reviews:create' movie.pk %}" class="btn btn-primary">レビューを書く</a>
{% endif %}
{% endblock content %}